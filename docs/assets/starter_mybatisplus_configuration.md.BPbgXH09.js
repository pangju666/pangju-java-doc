import{_ as i,c as a,o as n,ag as t}from"./chunks/framework.XA8aHGu3.js";const g=JSON.parse('{"title":"自动装配","description":"","frontmatter":{"layout":"doc"},"headers":[],"relativePath":"starter/mybatisplus/configuration.md","filePath":"starter/mybatisplus/configuration.md","lastUpdated":1764380858000}'),l={name:"starter/mybatisplus/configuration.md"};function p(h,s,k,e,r,d){return n(),a("div",null,[...s[0]||(s[0]=[t(`<h1 id="自动装配" tabindex="-1">自动装配 <a class="header-anchor" href="#自动装配" aria-label="Permalink to &quot;自动装配&quot;">​</a></h1><h2 id="说明" tabindex="-1">说明 <a class="header-anchor" href="#说明" aria-label="Permalink to &quot;说明&quot;">​</a></h2><p>我自动装配了<code>Mybatis Plus</code>常用的几个内置插件。</p><h2 id="插件列表" tabindex="-1">插件列表 <a class="header-anchor" href="#插件列表" aria-label="Permalink to &quot;插件列表&quot;">​</a></h2><ul><li><a href="https://baomidou.com/plugins/pagination/" target="_blank" rel="noreferrer">分页插件</a>：<code>MyBatis-Plus</code>的分页插件<code>PaginationInnerInterceptor</code>提供了强大的分页功能， 支持多种数据库，使得分页查询变得简单高效。</li><li><a href="https://baomidou.com/plugins/optimistic-locker/" target="_blank" rel="noreferrer">乐观锁插件</a>：乐观锁是一种并发控制机制，用于确保在更新记录时，该记录未被其他事务修改。 <code>MyBatis-Plus</code>提供了<code>OptimisticLockerInnerInterceptor</code>插件，使得在应用中实现乐观锁变得简单。</li><li><a href="https://baomidou.com/plugins/block-attack/" target="_blank" rel="noreferrer">防全表更新与删除插件</a>：<code>BlockAttackInnerInterceptor</code>是<code>MyBatis-Plus</code>框架提供的一个安全插件， 专门用于防止恶意的全表更新和删除操作。该插件通过拦截<code>update</code>和<code>delete</code>语句，确保这些操作不会无意中影响到整个数据表，从而保护数据的完整性和安全性。</li></ul><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>这些插件都是默认开启的，如果不需要的话，可以用配置属性关掉。</p><p>插件注册顺序：分页 -&gt; 乐观锁 -&gt; 防全表更新与删除</p><p><code>Bean</code>的注入顺序为最低优先级，方便用户注册其他插件。</p></div><h3 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-label="Permalink to &quot;配置&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这是我自己用的\`mybatis plus\`配置</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">mybatis-plus</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    type-aliases-package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">io.github.pangju666.test.entity</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 实体类包路径，配不配置都行</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    mapper-locations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">classpath:mapper/*.xml</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # mapper xml 映射文件路径</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 删除 SQL 中多余的空白字符。请注意，这也会影响 SQL 中的字面字符串。</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        shrink-whitespaces-in-sql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    global-config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        banner</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 禁用控制台 Banner</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        db-config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            column-format</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;\`%s\`&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 列名格式化，主要是防止和数据库关键字冲突</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            update-strategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ALWAYS</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 防止将值更新为 null 时失败</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            id-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">auto</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # id类型，我平时用自动增长比较多，分布式项目不建议用这个</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 我做的插件配置        </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    plugins</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 乐观锁插件配置</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        optimistic-locker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 是否启用乐观锁插件，默认为true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # 启用wrapper模式后，在Wrapper方式更新时也可以使用乐观锁</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            wrapper-mode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 是否启用wrapper模式，默认为true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 分页插件配置</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        pagination</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 是否启用分页插件，默认为true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            db-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">MYSQL</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 数据库类型，默认为 MySQL</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 防全表更新与删除插件配置</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        block-attack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 是否启用防全表更新与删除插件，默认为true</span></span></code></pre></div><h3 id="其他插件" tabindex="-1">其他插件 <a class="header-anchor" href="#其他插件" aria-label="Permalink to &quot;其他插件&quot;">​</a></h3><p>如果需要使用其他插件，可以选择自定义<code>Bean</code>来加载其他插件。</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>如果想覆盖掉我写的那几种插件配置，需要先在属性中禁用掉相关的配置。</p><p>插件注册顺序建议参考<code>Mybatis Plus</code>的<a href="https://baomidou.com/plugins/" target="_blank" rel="noreferrer">建议顺序</a>。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SpringBootConfiguration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BeanConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MybatisPlusInterceptor </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">customPlusInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		MybatisPlusInterceptor interceptor </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MybatisPlusInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 先从属性中禁用掉分页插件，然后自定义分页插件配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 不需要自定义分页插件的话，可以忽略这行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		interceptor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addInnerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PaginationInnerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(DbType.MYSQL);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// ... 自行添加其他插件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		interceptor.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addInnerInterceptor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> interceptor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="逻辑删除填充sql注入器" tabindex="-1">逻辑删除填充SQL注入器 <a class="header-anchor" href="#逻辑删除填充sql注入器" aria-label="Permalink to &quot;逻辑删除填充SQL注入器&quot;">​</a></h2><p>这个主要是用来配合我的<a href="/pangju-java-doc/starter/mybatisplus/annotation.html"><code>逻辑删除填充注解</code></a>，如果你想添加自己的SQL注入器，可以选择继承我的SQL注入器实现，然后添加自己的SQL注入方法。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomSqlInjector</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TableLogicFillSqlInjector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AbstractMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMethodList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Configuration </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, Class&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">mapperClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, TableInfo </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">tableInfo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">AbstractMethod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; superMethods </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMethodList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(configuration, mapperClass, tableInfo);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 添加自己的注入方法</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		superMethods.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newMethods;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SpringBootConfiguration</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BeanConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Bean</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	public</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ISqlInjector </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">customSqlInjector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomSqlInjector</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,15)])])}const c=i(l,[["render",p]]);export{g as __pageData,c as default};
