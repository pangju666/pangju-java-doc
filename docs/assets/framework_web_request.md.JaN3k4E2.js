import{_ as t,c as i,o as a,ag as e}from"./chunks/framework.XA8aHGu3.js";const c=JSON.parse('{"title":"Http请求工具类","description":"","frontmatter":{"layout":"doc"},"headers":[],"relativePath":"framework/web/request.md","filePath":"framework/web/request.md","lastUpdated":1762179755000}'),l={name:"framework/web/request.md"};function n(p,s,h,d,r,k){return a(),i("div",null,[...s[0]||(s[0]=[e(`<h1 id="http请求工具类" tabindex="-1">Http请求工具类 <a class="header-anchor" href="#http请求工具类" aria-label="Permalink to &quot;Http请求工具类&quot;">​</a></h1><p><code>io.github.pangju666.framework.web.servlet.utils.HttpRequestUtils</code></p><table tabindex="0"><thead><tr><th>方法名</th><th style="text-align:left;">返回值</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td>isFormMobile</td><td style="text-align:left;">boolean</td><td style="text-align:center;">判断请求是否来自移动设备</td></tr><tr><td>isFromAjax</td><td style="text-align:left;">boolean</td><td style="text-align:center;">判断请求是否为Ajax请求</td></tr><tr><td>getIpAddress</td><td style="text-align:left;">String</td><td style="text-align:center;">获取请求的来源IP地址</td></tr><tr><td>getParameters</td><td style="text-align:left;">MultiValueMap&lt;String, String&gt;</td><td style="text-align:center;">获取所有的请求参数</td></tr><tr><td>getHeaders</td><td style="text-align:left;">HttpHeaders</td><td style="text-align:center;">获取所有的请求头信息</td></tr><tr><td>getParts</td><td style="text-align:left;">Map&lt;String, Part&gt;</td><td style="text-align:center;">获取请求参数中的文件信息</td></tr><tr><td>getRawRequestBody</td><td style="text-align:left;">byte[]</td><td style="text-align:center;">获取原始请求体</td></tr><tr><td>getStringRequestBody</td><td style="text-align:left;">String</td><td style="text-align:center;">获取请求体的字符串表示</td></tr><tr><td>getJsonRequestBody</td><td style="text-align:left;">JsonElement或泛型</td><td style="text-align:center;">获取JSON格式的请求体并解析</td></tr><tr><td>isJsonRequestBody</td><td style="text-align:left;">boolean</td><td style="text-align:center;">判断请求体是否为JSON类型</td></tr></tbody></table><h2 id="判断请求" tabindex="-1">判断请求 <a class="header-anchor" href="#判断请求" aria-label="Permalink to &quot;判断请求&quot;">​</a></h2><h3 id="是否来自移动设备" tabindex="-1">是否来自移动设备 <a class="header-anchor" href="#是否来自移动设备" aria-label="Permalink to &quot;是否来自移动设备&quot;">​</a></h3><p>根据<a href="https://github.com/yangzongzhuan/RuoYi/blob/master/ruoyi-common/src/main/java/com/ruoyi/common/utils/ServletUtils.java" target="_blank" rel="noreferrer">RuoYi Common ServletUtils</a>修改</p><p>判断请求是否来自移动设备，通过分析<code>User-Agent</code>请求头判断请求是否来自移动设备，规则如下：</p><ul><li>排除 Windows 桌面系统（除了IE9）</li><li>排除 Mac 桌面系统</li><li>包含 MOBILE_AGENTS 中定义的移动设备标识</li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isFormMobile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 如果请求来自移动设备则返回true，否则返回false</span></span></code></pre></div><h3 id="是否为ajax请求" tabindex="-1">是否为Ajax请求 <a class="header-anchor" href="#是否为ajax请求" aria-label="Permalink to &quot;是否为Ajax请求&quot;">​</a></h3><p>根据<a href="https://github.com/yangzongzhuan/RuoYi/blob/master/ruoyi-common/src/main/java/com/ruoyi/common/utils/ServletUtils.java" target="_blank" rel="noreferrer">RuoYi Common ServletUtils</a>修改</p><p>判断请求是否为Ajax请求，通过以下方式判断是否为Ajax请求：</p><ul><li>检查<code>Accept</code>头是否包含<code>application/json</code></li><li>检查<code>X-Requested-With</code>头是否包含<code>XMLHttpRequest</code></li><li>检查<code>请求URI</code>是否包含<code>.json</code>或<code>.xml</code>后缀</li><li>检查请求参数<code>__ajax</code>是否包含<code>json</code>或<code>xml</code>值</li></ul><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isFromAjax</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 如果是Ajax请求则返回true，否则返回false</span></span></code></pre></div><h3 id="请求体是否为json" tabindex="-1">请求体是否为JSON <a class="header-anchor" href="#请求体是否为json" aria-label="Permalink to &quot;请求体是否为JSON&quot;">​</a></h3><p>通过检查Content-Type头部值，确定请求体是否为JSON格式。</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>此方法支持带字符集参数的JSON类型，如<code>application/json;charset=UTF-8</code>。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isJsonRequestBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 如果是Ajax请求则返回true，否则返回false</span></span></code></pre></div><h2 id="获取客户端请求ip地址" tabindex="-1">获取客户端请求IP地址 <a class="header-anchor" href="#获取客户端请求ip地址" aria-label="Permalink to &quot;获取客户端请求IP地址&quot;">​</a></h2><p>根据<a href="https://github.com/yangzongzhuan/RuoYi/blob/master/ruoyi-common/src/main/java/com/ruoyi/common/utils/ServletUtils.java" target="_blank" rel="noreferrer">RuoYi Common ServletUtils</a>修改</p><p>获取请求的来源IP地址，依次从以下请求头中获取IP地址：</p><ol><li>x-forwarded-for</li><li>Proxy-Client-IP</li><li>X-Forwarded-For</li><li>WL-Proxy-Client-IP</li><li>X-Real-IP</li><li>最后使用<code>request.getRemoteAddr()</code>;</li></ol><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>如果获取到的IP是本地IP，则返回标准IPv4本地地址(127.0.0.1)。</p><p>如果IP包含多个地址（多级代理），则使用<code>IpUtils.getMultistageReverseProxyIp</code>获取第一个非<code>unknown</code>地址。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String clientIp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getIpAddress</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 客户端请求IP地址</span></span></code></pre></div><h2 id="获取所有的请求参数" tabindex="-1">获取所有的请求参数 <a class="header-anchor" href="#获取所有的请求参数" aria-label="Permalink to &quot;获取所有的请求参数&quot;">​</a></h2><p>将请求参数转换为Spring的<code>MultiValueMap</code>结构，保持参数值的顺序。</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>对于单值请求参数直接存储；对于多值请求参数保留为<code>List</code>。</p><p>返回的<code>MultiValueMap</code>是不可修改的。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MultiValueMap&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; requestParams </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getParameters</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span></code></pre></div><h2 id="获取所有的请求头信息" tabindex="-1">获取所有的请求头信息 <a class="header-anchor" href="#获取所有的请求头信息" aria-label="Permalink to &quot;获取所有的请求头信息&quot;">​</a></h2><p>将所有请求头信息转换为Spring的<code>HttpHeaders</code>结构。</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>对于单值请求头直接存储；对于多值请求头保留为<code>List</code>。</p><p>返回的HttpHeaders是只读的。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpHeaders requestHeaders </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getHeaders</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span></code></pre></div><h2 id="获取请求参数中的文件信息" tabindex="-1">获取请求参数中的文件信息 <a class="header-anchor" href="#获取请求参数中的文件信息" aria-label="Permalink to &quot;获取请求参数中的文件信息&quot;">​</a></h2><p>从<code>form-data</code>请求参数中提取所有包含文件的部分。</p><p>该方法只返回那些具有提交文件名的部分（即实际上传的文件），过滤掉表单字段等不包含文件的部分。</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>返回的<code>Map</code>是不可修改的，以防止意外修改。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Part</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; fileParts </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getParts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Part part </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fileParts.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">values</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    String filename </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> part.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSubmittedFileName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 处理文件</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="获取原始请求体" tabindex="-1">获取原始请求体 <a class="header-anchor" href="#获取原始请求体" aria-label="Permalink to &quot;获取原始请求体&quot;">​</a></h2><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>如果请求体是JSON，请使用<code>HttpRequestUtils.getJsonRequestBody</code>。</p></div><h3 id="字节数组表示" tabindex="-1">字节数组表示 <a class="header-anchor" href="#字节数组表示" aria-label="Permalink to &quot;字节数组表示&quot;">​</a></h3><p>从HTTP请求中读取完整的请求体内容，并以字节数组形式返回。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">byte</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] requestBody </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getRawRequestBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span></code></pre></div><h3 id="字符串表示" tabindex="-1">字符串表示 <a class="header-anchor" href="#字符串表示" aria-label="Permalink to &quot;字符串表示&quot;">​</a></h3><p>将请求体内容读取并转换为字符串，字符集判断逻辑如下：</p><ol><li>尝试从<code>Content-Type</code>请求头提取字符集信息</li><li>如提取失败或字符集名称无效，则使用<code>UTF-8</code>作为默认字符集</li></ol><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String requestBody </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStringRequestBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span></code></pre></div><h3 id="获取json请求体" tabindex="-1">获取JSON请求体 <a class="header-anchor" href="#获取json请求体" aria-label="Permalink to &quot;获取JSON请求体&quot;">​</a></h3><h3 id="原始json" tabindex="-1">原始JSON <a class="header-anchor" href="#原始json" aria-label="Permalink to &quot;原始JSON&quot;">​</a></h3><p>读取请求体内容并将其解析为<code>JsonElement</code>，处理逻辑如下：</p><ol><li>验证请求头<code>Content-Type</code>是否为JSON格式</li><li>非JSON请求则返回<code>JsonNull</code>实例</li><li>读取请求体并解析为<code>JsonElement</code></li></ol><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JsonElement requestBody </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HttpRequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getJsonRequestBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request);</span></span></code></pre></div><h3 id="java-bean" tabindex="-1">Java Bean <a class="header-anchor" href="#java-bean" aria-label="Permalink to &quot;Java Bean&quot;">​</a></h3><p>读取请求体并将其反序列化为指定Java对象，处理逻辑如下：</p><ol><li>验证请求头<code>Content-Type</code>是否为JSON格式</li><li>非JSON请求则直接返回<code>null</code></li><li>解析请求体并转换为目标类型的对象实例</li></ol><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpServletRequest request; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请求信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">User user </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getJsonRequestBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request, User.class);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 转换为泛型集合</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> RequestUtils.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getJsonRequestBody</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(request, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TypeToken&lt;List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">User</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;(){});</span></span></code></pre></div>`,55)])])}const g=t(l,[["render",n]]);export{c as __pageData,g as default};
