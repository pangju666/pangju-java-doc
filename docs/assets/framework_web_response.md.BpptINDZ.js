import{_ as i,c as a,o as t,ag as e}from"./chunks/framework.XA8aHGu3.js";const o=JSON.parse('{"title":"Http响应构建器","description":"","frontmatter":{"layout":"doc"},"headers":[],"relativePath":"framework/web/response.md","filePath":"framework/web/response.md","lastUpdated":1762686709000}'),n={name:"framework/web/response.md"};function l(p,s,h,k,d,r){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="http响应构建器" tabindex="-1">Http响应构建器 <a class="header-anchor" href="#http响应构建器" aria-label="Permalink to &quot;Http响应构建器&quot;">​</a></h1><p><code>io.github.pangju666.framework.web.servlet.HttpResponseBuilder</code></p><p>这个类我本来是写成工具类的，但是实在是重载方法太多了，显得特别繁琐，我就改成链式调用了。</p><table tabindex="0"><thead><tr><th>方法名</th><th style="text-align:left;">返回值</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td>contentType</td><td style="text-align:left;">HttpResponseBuilder</td><td style="text-align:center;">设置响应内容类型</td></tr><tr><td>status</td><td style="text-align:left;">HttpResponseBuilder</td><td style="text-align:center;">设置响应状态码</td></tr><tr><td>buffer</td><td style="text-align:left;">HttpResponseBuilder</td><td style="text-align:center;">设置是否启用缓冲模式</td></tr><tr><td>characterEncoding</td><td style="text-align:left;">HttpResponseBuilder</td><td style="text-align:center;">设置响应字符编码</td></tr><tr><td>cacheControl</td><td style="text-align:left;">HttpResponseBuilder</td><td style="text-align:center;">设置缓存控制</td></tr><tr><td>contentDisposition</td><td style="text-align:left;">HttpResponseBuilder</td><td style="text-align:center;">设置文件下载的Content-Disposition响应头</td></tr><tr><td>write</td><td style="text-align:left;">void</td><td style="text-align:center;">将内容写入响应输出流</td></tr><tr><td>writeFile</td><td style="text-align:left;">void</td><td style="text-align:center;">将文件内容写入响应输出流</td></tr><tr><td>writeResult</td><td style="text-align:left;">void</td><td style="text-align:center;">将Result对象以JSON格式写入响应输出流</td></tr><tr><td>writeBean</td><td style="text-align:left;">void</td><td style="text-align:center;">将Java对象包装为Result并以JSON格式写入响应输出流</td></tr><tr><td>writeHttpException</td><td style="text-align:left;">void</td><td style="text-align:center;">处理HTTP异常并将错误信息以JSON格式写入响应输出流</td></tr></tbody></table><h2 id="设置启用缓冲模式" tabindex="-1">设置启用缓冲模式 <a class="header-anchor" href="#设置启用缓冲模式" aria-label="Permalink to &quot;设置启用缓冲模式&quot;">​</a></h2><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>如果响应内容不是很大的话，没必要用缓冲。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置缓冲区大小</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8192</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="设置响应内容类型" tabindex="-1">设置响应内容类型 <a class="header-anchor" href="#设置响应内容类型" aria-label="Permalink to &quot;设置响应内容类型&quot;">​</a></h2><p>如果传入的contentType为null或空白字符串，则不执行任何操作。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;application/octet-stream&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="设置响应状态码" tabindex="-1">设置响应状态码 <a class="header-anchor" href="#设置响应状态码" aria-label="Permalink to &quot;设置响应状态码&quot;">​</a></h2><p>如果传入的status为null或小于100，则不执行任何操作。</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>建议使用<code>HttpStatus</code>设置响应状态码，而不是直接用数字。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatus.OK);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="设置响应字符编码" tabindex="-1">设置响应字符编码 <a class="header-anchor" href="#设置响应字符编码" aria-label="Permalink to &quot;设置响应字符编码&quot;">​</a></h2><p>如果传入的charset为null或空白字符串，则不执行任何操作。</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>一般不需要设置这个，直接用默认的<code>UTF-8</code>就行。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">characterEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(StandardCharsets.UTF_8);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 也可以直接用字符串设置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">characterEncoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UTF-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="设置缓存控制头" tabindex="-1">设置缓存控制头 <a class="header-anchor" href="#设置缓存控制头" aria-label="Permalink to &quot;设置缓存控制头&quot;">​</a></h2><p>如果传入的参数为null，则不执行任何操作。</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>一般不需要设置这个，如果你是返回静态资源的话，建议加上这个。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置缓存时间为1天</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cacheControl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Duration.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ofDays</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 想要精细控制的话，可以传入CacheControl对象</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cacheControl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CacheControl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">maxAge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Duration.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ofDays</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cachePublic</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span></code></pre></div><h2 id="设置文件下载响应头" tabindex="-1">设置文件下载响应头 <a class="header-anchor" href="#设置文件下载响应头" aria-label="Permalink to &quot;设置文件下载响应头&quot;">​</a></h2><p>通过添加<code>Content-Disposition</code>响应头，将响应设置为文件下载模式。</p><p>文件名会使用URL编码处理，确保在不同浏览器中正确显示。</p><p>如果传入的文件名为<code>null</code>或空白字符串，则不执行任何操作。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contentDisposition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 指定字符集</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contentDisposition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test.txt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, StandardCharsets.UTF_8);</span></span></code></pre></div><h2 id="将内容写入响应输出流" tabindex="-1">将内容写入响应输出流 <a class="header-anchor" href="#将内容写入响应输出流" aria-label="Permalink to &quot;将内容写入响应输出流&quot;">​</a></h2><h3 id="字节数组" tabindex="-1">字节数组 <a class="header-anchor" href="#字节数组" aria-label="Permalink to &quot;字节数组&quot;">​</a></h3><p>会根据字节数组大小自动设置<code>Content-Length</code>响应头。</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 写入字节数组</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bytes);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 设置响应内容类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image/jpeg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 设置响应状态码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatus.FOUND)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(bytes);</span></span></code></pre></div><h3 id="输入流" tabindex="-1">输入流 <a class="header-anchor" href="#输入流" aria-label="Permalink to &quot;输入流&quot;">​</a></h3><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>如果选择开启缓冲区的话，会将非<code>BufferedInputStream</code>、<code>UnsynchronizedByteArrayInputStream</code>、<code>UnsynchronizedBufferedInputStream</code>、 <code>BufferedFileChannelInputStream</code>输入流包装为<code>UnsynchronizedBufferedInputStream</code>。</p><p>不确定流大小的话，建议开启缓冲区。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 写入输入流</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inputstream);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 设置响应内容类型</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contentType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;image/jpeg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 设置响应状态码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(HttpStatus.FOUND)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inputstream);</span></span></code></pre></div><h2 id="将文件写入响应输出流" tabindex="-1">将文件写入响应输出流 <a class="header-anchor" href="#将文件写入响应输出流" aria-label="Permalink to &quot;将文件写入响应输出流&quot;">​</a></h2><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>如果选择开启缓冲区的话，会使用<code>UnsynchronizedBufferedInputStream</code>打开文件输入流。</p><p>如果文件很大的话，建议使用缓冲区读取。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">File file </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> File</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用缓冲区</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用指定的下载文件名</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(file, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;avatar.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h2 id="将对象写入响应输出流" tabindex="-1">将对象写入响应输出流 <a class="header-anchor" href="#将对象写入响应输出流" aria-label="Permalink to &quot;将对象写入响应输出流&quot;">​</a></h2><p>将Java对象以JSON格式写入响应输出流，该方法会智能处理传入的对象类型：</p><ul><li>如果对象已经是<code>Result</code>类型：直接序列化为JSON并写入响应</li><li>如果对象是其他类型：自动包装为<code>Result.ok(bean)</code>后再序列化写入</li></ul><p>自动执行以下操作：</p><ul><li>设置<code>Content-Type</code>为<code>application/json</code></li><li>使用<code>UTF-8</code>字符集编码</li><li>将对象转换为JSON字符串并写入响应输出流</li></ul><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p>写入Bean的时候建议不开启缓冲区，除非这个Bean是超大集合或者超长字符串。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeBean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// {&quot;code&quot;: 0, &quot;message&quot;:&quot;请求成功&quot;, &quot;data&quot;:null}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeBean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Result.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ok</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// {&quot;code&quot;: 0, &quot;message&quot;:&quot;请求成功&quot;, &quot;data&quot;:&quot;test&quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeBean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// {&quot;code&quot;: 0, &quot;message&quot;:&quot;请求成功&quot;, &quot;data&quot;:&quot;test&quot;}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeBean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// {&quot;code&quot;: 0, &quot;message&quot;:&quot;请求成功&quot;, &quot;data&quot;:null}</span></span></code></pre></div><h2 id="处理http异常" tabindex="-1">处理HTTP异常 <a class="header-anchor" href="#处理http异常" aria-label="Permalink to &quot;处理HTTP异常&quot;">​</a></h2><p>处理<a href="/pangju-java-doc/framework/web/exception.html">HTTP异常</a>并将错误信息以JSON格式写入响应输出流，处理流程：</p><ol><li>检查异常类是否有<code>@HttpException</code>注解</li><li>如果有注解： <ol><li>根据注解配置的错误码类型和错误码生成<code>Result</code></li><li>如果注解配置了需要记录日志，则按指定级别记录日志</li><li>设置响应状态码为注解中配置的状态码</li></ol></li><li>如果没有注解： <ol><li>使用默认错误码（-1）生成<code>Result</code></li><li>记录<code>ERROR</code>级别日志</li></ol></li><li>设置<code>Content-Type</code>为application/json</li><li>将<code>Result</code>序列化为JSON并写入响应</li></ol><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p>这个方法我禁用了缓冲区，异常信息不会特别大，没必要用缓冲区。</p></div><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HttpResponseBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(response).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeHttpException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ServiceException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;测试错误&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// {&quot;code&quot;: -1000, &quot;message&quot;:&quot;测试错误&quot;, &quot;data&quot;:null}</span></span></code></pre></div>`,49)])])}const c=i(n,[["render",l]]);export{o as __pageData,c as default};
